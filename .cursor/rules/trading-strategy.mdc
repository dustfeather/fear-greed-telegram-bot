---
description: Trading strategy rules and data source specifications
globs: ["**/*.ts", "**/trading-signal.ts", "**/market-data.ts", "**/indicators.ts"]
alwaysApply: false
---

# Trading Strategy Rules

## Data Sources

### Price Data
- **Source**: Yahoo Finance API
- **URL**: https://query1.finance.yahoo.com/v8/finance/chart/SPY
- **Symbol**: SPDR S&P 500 ETF (SPY)
- **Data Extracted**:
  - Current price (`regularMarketPrice`)
  - Historical price data (200+ days) for indicator calculations
  - OHLCV data (Open, High, Low, Close, Volume) arrays
  - Timestamps array

### Fear & Greed Index
- **Source**: CNN Fear & Greed Index API
- **URL**: https://production.dataviz.cnn.io/index/fearandgreed/current
- **Data Extracted**:
  - `rating`: String value ("fear", "extreme fear", "neutral", "greed", "extreme greed")
  - `score`: Numeric value (0-100)
  - `timestamp`: Timestamp of the data
  - Optional fields: `previous_close`, `previous_1_week`, `previous_1_month`, `previous_1_year`
- **Extraction Method**:
  - Uses browser-like headers (CHROME_HEADERS) to prevent bot detection
  - Normalizes response (handles string/number conversions)
  - Validates response structure before processing

## Trading Indicators Configuration
- **SMA 20**: 20-day Simple Moving Average
- **SMA 50**: 50-day Simple Moving Average
- **SMA 100**: 100-day Simple Moving Average
- **SMA 200**: 200-day Simple Moving Average
- **Bollinger Bands**: 
  - Base: SMA 20 days
  - Standard Deviation: 2

## Entry Conditions

### Condition A: New BUY Signal Formula with 1% SMA Buffer
- **Trigger**: Current price meets one of the following conditions:
  - (Price within 1% of SMA20 OR price <= SMA20) AND (Price within 1% or lower than lower Bollinger Band) OR
  - (Price within 1% of SMA50 OR price <= SMA50) OR
  - (Price within 1% of SMA100 OR price <= SMA100) OR
  - (Price within 1% of SMA200 OR price <= SMA200)
- **Formula**: `(price <= SMA20 * 1.01 AND price <= lowerBB * 1.01) OR price <= SMA50 * 1.01 OR price <= SMA100 * 1.01 OR price <= SMA200 * 1.01`
- **Note**: The 1% buffer allows signals to trigger slightly before price hits the SMA, providing earlier entry opportunities

### Condition B: Price Near Bollinger Band Lower
- **Trigger**: Current price gets near the Bollinger Band lower band
- **Threshold**: Price must be within 1% of the lower Bollinger Band or below it
- **Formula**: `currentPrice <= bollingerLowerBand * 1.01`
- **Note**: This condition is still evaluated for display purposes but is now incorporated into Condition A

### Condition C: Fear & Greed Index
- **Source**: CNN Fear & Greed Index
- **Required Values**: "fear" OR "extreme fear"

### Entry Rule
- **Formula**: Condition A AND Condition C
- **Action**: Execute BUY order when all conditions are met

## Trading Frequency Limit
- **Maximum Trades**: 1 per calendar month
- **Enforcement**: Do not execute more than one trade within the same calendar month (based on month name, e.g., January, February)

## Exit Strategy (Profit-Taking)
- **Method**: All time high or near BB higher
- **Target Level**: price within 1% or higher than all time high OR price within 1% or higher than BB upper, and profit is positive
- **Formula**: (currentPrice >= allTimeHigh * 0.99 AND profit > 0) OR (currentPrice >= bollingerUpperBand * 0.99 AND profit > 0)
- **Action**: Execute SELL order when all conditions are met
